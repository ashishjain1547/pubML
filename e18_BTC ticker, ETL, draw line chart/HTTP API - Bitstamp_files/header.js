var Header=(function(){var r={balanceUpdateInterval:30,dropdownSelectors:{'#currency-pairs-dropdown':'#subaccount-dropdown, #account-dropdown','#subaccount-dropdown':'#currency-pairs-dropdown, #account-dropdown','#account-dropdown':'#currency-pairs-dropdown, #subaccount-dropdown'},dropdownScrollbars:{'#account-dropdown':'#sub-account-overview'},headerSelectors:{'#control':'#subaccount, #account','#subaccount':'#control, #account','#account':'#control, #subaccount'},isAuthenticated:$('body').data('authenticated'),showHide:function(showDropdown,hideDropdown,showHeading,hideHeading){$(showDropdown).toggle();$(showHeading).toggleClass('active-background','');$(r.dropdownScrollbars[showDropdown]).perfectScrollbar();$(hideDropdown).hide();$(hideHeading).removeClass('active-background');$(r.dropdownScrollbars[hideDropdown]).perfectScrollbar('destroy');},deselect:function(dropdown,heading){$(document).on('click',function(ev){if($(ev.target).closest(dropdown).length===0){$(dropdown).hide();$(heading).removeClass('active-background');}});},initPairSelect:function(){$('#select-currency').on('click',function(ev){var selectedDropdown='#currency-pairs-dropdown',selectedHeading='#control';r.showHide(selectedDropdown,r.dropdownSelectors[selectedDropdown],selectedHeading,r.headerSelectors[selectedHeading]);r.deselect(selectedDropdown,selectedHeading);ev.stopPropagation();});},initSubaccountSelect:function(){$('#select-subaccount').on('click',function(ev){var selectedDropdown='#subaccount-dropdown',selectedHeading='#subaccount';r.showHide(selectedDropdown,r.dropdownSelectors[selectedDropdown],selectedHeading,r.headerSelectors[selectedHeading]);$('#subaccount-dropdown').css({right:$('#account').outerWidth(true)});r.deselect(selectedDropdown,selectedHeading);ev.stopPropagation();});},initAccountDetails:function(){$('.trade-account-row').each(function(i,row){$.ajax({url:$(row).data('details'),method:'GET',type:'GET',success:function(data){$(row).find('.sub-account-name').text(data.name);$.each(data.balances,function(key,value){$(row).find('.sub-account-'+key).text(value);});}});});$.ajax({url:$('#main-balance').data('details'),method:'GET',type:'GET',success:function(data){$.each(data.main_balances,function(key,value){$('.main-balance-'+key).text(value);});$.each(data.total_balances,function(key,value){$('.total-value-'+key).text(value);});}});},initAccountSelect:function(){$('#select-account').on('click',function(ev){var selectedDropdown='#account-dropdown',selectedHeading='#account';r.showHide(selectedDropdown,r.dropdownSelectors[selectedDropdown],selectedHeading,r.headerSelectors[selectedHeading]);r.deselect(selectedDropdown,selectedHeading);ev.stopPropagation();});},initSwitchCurrencyPair:function(){$('#currency-pairs-dropdown').on('click','li:not(.group-title)',function(){var item=$(this);$.ajax({url:$('#currency-pairs-dropdown').data('url'),data:{currencyPair:item.data('setter'),isTradeview:$('body').data('tradeview')||0},method:'POST',type:'POST',success:function(data){if(data.status==='ok'){if(data.change==='false'){item.blur();}else{window.location.reload();}}}})});},updateBalance:function(){var pair=$('#header-control').data('pair'),base_currency=pair.split('/')[0],counter_currency=pair.split('/')[1];if(r.isAuthenticated!=='True'){return;}
$.ajax({url:'/ajax/header-balance/'+base_currency+'/'+counter_currency+'/',type:'GET',dataType:'json',success:function(data){$('#balance-'+base_currency).text(data.base_balance);$('#balance-'+counter_currency).text(data.counter_balance);$('#selected-account-balance-'+base_currency).text(data.base_available);$('#selected-account-balance-'+counter_currency).text(data.counter_available);$('#account-value-'+base_currency).text(data.base_account_value);$('#account-value-'+counter_currency).text(data.counter_account_value);$('#balance-'+base_currency+'-mobile').text(data.base_balance);$('#balance-'+counter_currency+'-mobile').text(data.counter_balance);$('#selected-account-balance-'+base_currency+'-mobile').text(data.base_available);$('#selected-account-balance-'+counter_currency+'-mobile').text(data.counter_available);$('#account-value-'+base_currency+'-mobile').text(data.base_account_value);$('#account-value-'+counter_currency+'-mobile').text(data.counter_account_value);}});},updateLastPrice:function(){var pair_data=$('#last-price').data();$.ajax({dataType:'json',url:'/api/v2/ticker/'+pair_data.pair+'/',success:function(data){$('#last-price').find('strong').text(parseFloat(data.last).toFixed(pair_data.decimalCounter));}});},initRefreshHeaderData:function(){setInterval(function(){r.updateBalance();r.updateLastPrice();},r.balanceUpdateInterval*1000);},initSetHeaderHeight:function(){var headerHeight=$('#header').height(),lastScroll=$(window).scrollTop(),maxHeight=$(document).height()-$(window).height();$(window).on('scroll',function(){var scrollTop=$(window).scrollTop(),headerHeight=$('#header').height();if(scrollTop<0){scrollTop=0;}
if(scrollTop>=maxHeight){scrollTop=maxHeight-1;}
if(lastScroll<scrollTop){$('#header').addClass('collapse');}
else{$('#header').removeClass('collapse');}
lastScroll=scrollTop;});},initShowMobileMenu:function(){var headerContainer=$('#header-top-mobile .container'),menuIcon=$('#header-top-mobile img'),menuBack=$('#header-top-mobile .back'),tradeAccountsCount=$('#select-subaccount-mobile').data('trade-account-count');menuIcon.on('click',function(){headerContainer.animate({left:'10vw'});});menuBack.on('click',function(){headerContainer.animate({left:'104vw'});});headerContainer.find('.details-parent').on('click',function(){var detailsButton=$(this),detailsContent=detailsButton.next();if(detailsContent.hasClass('visible')){detailsContent.removeClass('visible');detailsButton.find('span').removeClass();detailsButton.find('span').addClass('fa fa-angle-down');}else{detailsContent.addClass('visible');detailsButton.find('span').removeClass();detailsButton.find('span').addClass('fa fa-angle-up');}});$('#select-subaccount-mobile').css('height',(tradeAccountsCount+1)*20+'px');}},u={initialize:function(){r.initPairSelect();r.initSubaccountSelect();r.initSwitchCurrencyPair();r.initAccountSelect();r.initAccountDetails();r.initRefreshHeaderData();r.initSetHeaderHeight();r.initShowMobileMenu();}};return u;}());$(Header.initialize);